<!DOCTYPE html>
<html>
<body>
    <canvas id="myCanvas" width="1350" height="660" style="border:1px solid #d3d3d3;"></canvas>
    <img id="rocket" src="rocket2.png" style="display: none" alt="rocket"/>
    <img id="robot" src="robot.png" style="display: none" alt="robot"/>

<script>

var asteroid1 = new Image();
var asteroid2 = new Image();
var asteroid3= new Image();
var asteroid4= new Image();
var bottles= new Image();
var earth = new Image();
var background = new Image();

var robotX = 1050;
var robotY = 210;

var actors = [];

let i = 0;

const result = document.getElementById('result');

function init() {
    earth.src = 'earth.png';
    asteroid1.src = 'asteroid1.png';
    asteroid2.src = 'asteroid2.png';
    asteroid3.src = 'asteroid3.png';
    asteroid4.src = 'asteroid4.png';
    bottles.src = 'bottles.png';
    background.src = 'background.jpg';

    
    actors.push({target: false, image: asteroid1, x: 210, y: 0});
    actors.push({target: false, image: asteroid2, x: -200, y: 220});
    actors.push({target: false, image: asteroid3, x: -255, y: -150});
    actors.push({target: false, image: asteroid4, x: 130, y: -315});
    actors.push({target: false, image: asteroid2, x: 250, y: 45});
    actors.push({target: false, image: asteroid1, x: -385, y: 100});
    actors.push({target: true, image: bottles, x: 110, y: 220});
    actors.push({target: true, image: bottles, x: 150, y: 40});
    actors.push({target: true, image: bottles, x: 150, y: -140});
    actors.push({target: false, image: asteroid1, x: -320, y: 150});
    actors.push({target: false, image: asteroid4, x: 150, y: -430});
    actors.push({target: false, image: asteroid3, x: -205, y: 100});
    actors.push({target: true, image: bottles, x: 0, y: 200});
    actors.push({target: true, image: bottles, x: 400, y: -100});
    actors.push({target: true, image: bottles, x: -300, y: -150});
    actors.push({target: true, image: bottles, x: -100, y: 150});
    

    window.requestAnimationFrame(draw);

    window.addEventListener(
        'keydown', 
        function (e) {
            switch (e.keyCode) {
                case 37:
                    robotX -= 2; 
                    break;
                case 39:
                    robotX += 2; 
                    break;
                case 38:
                    robotY -= 2; 
                    break;
                case 40:
                    robotY += 2; 
                    break;
                case 40:

                    break;

            }
        }
    );   

}

function draw(){

    var ctx = document.getElementById('myCanvas').getContext('2d');

    ctx.globalCompositeOperation = 'destination-over';
    ctx.clearRect(0, 0, 3000, 3000);

    ctx.fillStyle = 'rgba(0, 0, 0, 0.4)';
    ctx.strokeStyle = 'rgba(0, 153, 255, 0.4)';
    ctx.save();
    ctx.translate(675, 330);

    var time = new Date();
    ctx.rotate(((2 * Math.PI) / 60) * time.getSeconds() + ((2 * Math.PI) /60000) * time.getMilliseconds());

    let isCollision = false;
    let isTouched = false;

    for (let actor of actors) {
        ctx.translate(actor.x, actor.y);
        ctx.beginPath();
        ctx.arc(30, 20, 20, 0, 2 * Math.PI);
        ctx.stroke();
        ctx.drawImage(actor.image, 15, 10.5);

        if (actor.target) {
            isTouched = isTouched || ctx.isPointInStroke(robotX, robotY);
        }
        else {
            isCollision = isCollision || ctx.isPointInStroke(robotX, robotY);
        }
    }
    
    ctx.restore();
    
    ctx.beginPath();
    ctx.arc(675, 330, 152.5, 0, Math.PI * 2, false);
    ctx.stroke();
    
    var c = document.getElementById("myCanvas");
    var ctx = c.getContext("2d");
    var img = document.getElementById("rocket");
    ctx.drawImage(img, 1100, 180, 120, 100);
    var img = document.getElementById("robot");
    ctx.drawImage(img, robotX, robotY, 30, 40);
    if(isCollision)
    {
        alert("Game over:");
        i = 0;
        alert(i);
        robotX = 1050;
        robotY = 210;
    }

    if(isTouched)
    {
        i += 4;
        alert(i);
        if(i == 100)
        {
            alert("You saved the world!");
            ctx.clearRect(0, 0, 3000, 3000);
            var c = document.getElementById("myCanvas");
            var ctx = c.getContext("2d");
            var img = document.getElementById("rocket");
            ctx.drawImage(img, 1100, 180, 120, 100);
            ctx.drawImage(earth, 525, 175, 305, 305);
            ctx.drawImage(background, 0, 0, 1350, 660);
        }
    }
    
    ctx.drawImage(earth, 525, 175, 305, 305);
    ctx.drawImage(background, 0, 0, 1350, 660);

    window.requestAnimationFrame(draw);

    var c = document.getElementById("myCanvas");
    var ctx = c.getContext("2d");
    ctx.beginPath();
    ctx.arc(675, 330, 152.5, 0, 2 * Math.PI);
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(675, 330, 185, 0, 2 * Math.PI);
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(675, 330, 220, 0, 2 * Math.PI);
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(675, 330, 240, 0, 2 * Math.PI);
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(675, 330, 260, 0, 2 * Math.PI);
    ctx.stroke();
}

init();

</script>
</body>
</html>
